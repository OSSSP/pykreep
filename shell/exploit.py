try:
    import gnureadline
    import sys

    sys.modules['readline'] = gnureadline
except ImportError:
    pass

import cmd

import core.errors
import core.kmoduleloader as loader


class ExploitShell(cmd.Cmd):
    prompt = ''
    module = None # type: 'KExploit'

    def __init__(self, exploit_name):
        super().__init__()
        self.prompt = 'K:' + exploit_name + '>'

        if not exploit_name:
            raise core.errors.InvalidCommandArgumentError('Missing command argument \'name\'')

        self.exploit_name = exploit_name
        mod_loader = loader.KModuleLoader()
        self.module = mod_loader.load_exploit(exploit_name)

    def do_params(self, _):
        self.module.params.pretty_print()

    def help_params(self):
        print('Shows available parameters and values for exploit')

    def do_back(self, p):
        return True

    def emptyline(self):
        pass

    def do_EOF(self, line):
        return True

    def postloop(self):
        print()
